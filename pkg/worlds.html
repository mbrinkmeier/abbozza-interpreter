<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <link rel="icon" type="image/png" href="img/abbozza_icon.png">

        <title>abbozza!</title>
        <script type="text/javascript">
        getIdFromPath = function(path) {
            var prefix = "/abbozza/world/";
            var start = path.indexOf(prefix);
            if ( start >= 0 ) {
                var start = start + prefix.length;
                var end = path.indexOf("/",start);
                return path.substring(start,end);
            } else {
                // Default context is consol
                return "console";
            }
        }    
            
        var worldId = getIdFromPath(window.location.href);
        </script>
        
	<!--link rel="stylesheet" href="samples.css"-->
        <!-- link rel="stylesheet" href="js/SCEditor/themes/default.min.css" id="theme-style" /-->
        <link rel="stylesheet" type="text/css" href="/js/codemirror/lib/codemirror.css">
        <link rel="stylesheet" type="text/css" href="/css/abbozza.css">
        <link rel="stylesheet" type="text/css" href="/css/worlds.css">
        <link rel="stylesheet" type="text/css" href="World.css">
        
        <script src="/js/polyfill/CustomElements.js"></script>
        <script src="/js/blockly/blockly_compressed_new.js"></script>
        <script src="/js/ckeditor/ckeditor.js"></script>
        <script src="/js/codemirror/lib/codemirror.js"></script>
        <script src="/js/codemirror/mode/javascript/javascript.js"></script>
        <script src="/lib/acorn_interpreter.js"></script>
        <script src="/js/abbozza/core/Generator.js" type="text/javascript"></script>

        <!-- worlds specific classes -->
        <script src="/js/abbozza/worlds/DummyBoard.js" type="text/javascript"></script>
        <script src="/js/abbozza/worlds/GeneratorJavaScript.js" type="text/javascript"></script>
        <script src="/js/abbozza/worlds/CodeJavaScript.js" type="text/javascript"></script>
        <script src="/js/abbozza/worlds/Splitter.js" type="text/javascript"></script>
        <script src="/js/abbozza/worlds/TabPane.js" type="text/javascript"></script>
        
        <!-- general classes -->
        <script src="/js/abbozza/core/ToolboxMgr.js" type="text/javascript"></script>        
        <script src="/js/abbozza/core/ColorMgr.js" type="text/javascript"></script>        
        <script src="/js/abbozza/core/Connection.js" type="text/javascript"></script>
        <script src="/js/abbozza/core/Validator.js" type="text/javascript"></script>  
        <script src="/js/abbozza/core/SymbolDB.js" type="text/javascript"></script>
        <script src="/js/abbozza/core/DeviceDB.js" type="text/javascript"></script>
        <script src="/js/abbozza/gui/field_nameinput.js"></script>
        <script src="/js/abbozza/gui/field_devnameinput.js"></script>
        <script src="/js/abbozza/gui/field_lengthinput.js"></script>
        <script src="/js/abbozza/gui/field_variabledropdown.js"></script>
        <script src="/js/abbozza/gui/field_devicedropdown.js"></script>
        <script src="/js/abbozza/gui/field_functiondropdown.js"></script>
        <script src="/js/abbozza/gui/field_slider.js"></script>
        <script src="/js/abbozza/gui/field_pindropdown.js"></script>
        <script src="/js/abbozza/gui/InternalWindow.js" type="text/javascript"></script>	
        <script src="/js/abbozza/core/AbbozzaBubble.js" type="text/javascript"></script>	
        <script src="/js/abbozza/core/TaskHintIcon.js" type="text/javascript"></script>
        <script src="/js/abbozza/core/TaskWindow.js" type="text/javascript"></script>
        <script src="/js/abbozza/core/TaskHint.js" type="text/javascript"></script>
        <script src="/js/abbozza/core/Configuration.js" type="text/javascript"></script>
        <script src="/js/abbozza/core/ErrorMgr.js" type="text/javascript"></script>
        <script src="/js/abbozza/core/TabMgr.js" type="text/javascript"></script>
        <script src="/js/abbozza/core/DynamicMutator.js" type="text/javascript"></script>
        <script src="/js/abbozza/core/DraggingManager.js" type="text/javascript"></script>
        
        <script src="/js/abbozza/worlds/AbbozzaWorld.js" type="text/javascript"></script>
        <script src="World.js" type="text/javascript"></script>
        
        <script src="/js/abbozza/core/Abbozza.js" type="text/javascript"></script>
        <script src="/js/abbozza/core/Tools.js" type="text/javascript"></script>

        <script src="/js/abbozza/blocks/Unknown.js" type="text/javascript"></script>

        <!-- worlds specific stuff -->
        <script src="/js/abbozza/worlds/Abbozza.js" type="text/javascript"></script>
        <script src="/js/abbozza/worlds/Interpreter.js" type="text/javascript"></script>
        <script src="Tools.js" type="text/javascript"></script>
        

        <!-- world specific blocks -->
        <script src="/js/abbozza/worlds/blocks/Main.js" type="text/javascript"></script>
        <script src="/js/abbozza/worlds/blocks/Keyboard.js" type="text/javascript"></script>
        <script src="/js/abbozza/worlds/Execs.js" type="text/javascript"></script>
        <script src="Blocks.js" type="text/javascript"></script>
        
        <!-- general blocks -->
        <script src="/js/abbozza/blocks/Conditionals.js" type="text/javascript"></script>
        <script src="/js/abbozza/blocks/Loops.js" type="text/javascript"></script>
        <script src="/js/abbozza/blocks/Math.js" type="text/javascript"></script>
        <script src="/js/abbozza/blocks/Logic.js" type="text/javascript"></script>
        <script src="/js/abbozza/blocks/Text.js" type="text/javascript"></script>
        <script src="/js/abbozza/blocks/Parser.js" type="text/javascript"></script>
        <script src="/js/abbozza/blocks/Variable.js" type="text/javascript"></script>
        <script src="/js/abbozza/blocks/Functions.js" type="text/javascript"></script>
        
        <!-- The plugins -->
        <script src="/abbozza/plugins/plugins.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            function init() {
                Abbozza.worldId = worldId;
                Abbozza.init('worlds',true,'http://inf-didaktik.rz.uos.de/abbozza/calliope/help');
                ToolboxMgr.rebuild();
                Abbozza.splitter = new Splitter(document.getElementById('splitter'), "");                
                AbbozzaInterpreter.init();
                AbbozzaInterpreter.setSpeed(75);
                var tabs = new TabPane(document.getElementById('tabs'));
                var infoPane = tabs.addPane(_("gui.information"),document.getElementById("worldinfo"));
                var debugPane;
                if ( Configuration.getParameter("option.debug") == "true" ) {
                    debugPane = tabs.addPane(_("gui.debug"),document.getElementById("debug"));
                    Abbozza.initDebugger(debugPane);
                } else {
                    debugPane = document.getElementById("debug");
                    debugPane.style.display="none";
                }
                var sourcePane;
                if ( Configuration.getParameter("option.source") == "true" ) {
                     sourcePane = tabs.addPane(_("gui.source"),document.getElementById("source"));
                } else {
                    sourcePane = document.getElementById("source");
                    sourcePane.style.display="none";
                 }
                Abbozza.sourceEditor = CodeMirror.fromTextArea(document.getElementById("sourceeditor"), {
                    mode: "javascript",
                    lineNumbers : true,
                    styleSelectedText : true
                    });
                Abbozza.sourceEditor.setSize(null,"100%");
                tabs.openTab(infoPane);
                World._init();
           }
        </script>
    </head>

    <body onload="init()">

        <div id="overlay" onclick="Abbozza.overlayClicked(this, event)">
            <div id="overlay_content">
            </div>
        </div>
        
        <div id="header">
            <div id="speedslider">
            <span>Langsam</span>
            <input type="range" id="speed" name="speed" step="5" min="0" max="100" list="speedticks" oninput="AbbozzaInterpreter.setSpeed(this.value);"/>
            <span>Schnell</span>
            </div>
        </div>
        <div id="splitter" style="position: fixed; width: 100%; top:50px; bottom:0px;">
            <div id=".topleft" style="min-height: 50px; min-width: 50px"></div>
            <div id=".bottomleft" style="min-height: 50px; min-width: 50px">
                <div id="tabs" style="position:absolute; width: 100%; height:100%;">
                </div>
                <div id="debug">
                    <div id="debug.headline">
                        <span id="stepLabel">Schritte: </span><span id="stepCounter">0</span>
                        &nbsp;&nbsp;
                        <span id="blockLabel">Bl√∂cke: </span><span id="blockCounter">0</span>
                        <div id="debug_addWatch" onclick="Abbozza.addDebugView()">+</div>
                    </div>
                    <div id="debugViews">
                            
                    </div>                   
                </div>
                <div id="source">
                    <div class="sourcebuttons">
                        <img class="sourcebutton" onclick="Abbozza.generateSource()" src="/img/generate.png"/>
                        <img class="sourcebutton" onclick="Abbozza.stepSource()" src="/img/step.png"/>
                        <img class="sourcebutton" onclick="Abbozza.runSource()" src="/img/run.png"/>
                        <img class="sourcebutton" onclick="Abbozza.stopSource()" src="/img/stop.png"/>
                        <img class="sourcebutton" onclick="Abbozza.loadSource()" src="/img/load.png"/>
                        <img class="sourcebutton" onclick="Abbozza.saveSource()" src="/img/save.png"/>
                    </div>
                    <div class="sourcewrapper">
                        <textarea class="sourceeditor" id="sourceeditor"></textarea>
                    </div>
                </div>     
                <div id="worldinfo">
                    <iframe id="info" src="Infos.html" style="width: 100%; height: 100%; border: none;"></iframe>
                </div>
            </div>
            <div id=".right" style="min-height: 50px; min-width: 100px">
                <div id="workspace" style="position: fixed"></div>                
                <div class="topButton" id="step" title="Step" onclick="AbbozzaInterpreter.step()"><img width=50 height=50  src="img/step.png"></div>
                <div class="topButton" id="run" title="Run" onclick="AbbozzaInterpreter.run()"><img width=50 height=50  src="img/run.png"></div>
                <div class="topButton" id="stop" title="Stop" onclick="AbbozzaInterpreter.stop()"><img width=50 height=50  src="img/stop.png"></div>
                <div class="topButton" id="new" title="Neuer Sketch" onclick="AbbozzaInterpreter.newSketch()"><img width=50 height=50  src="img/new.png"></div>
                <div class="topButton" id="load" title="Lade Sketch" onclick="Abbozza.loadSketch()"><img width=50 height=50  src="img/load.png"></div>
                <div class="topButton" id="save" title="Speichere Sketch" onclick="Abbozza.saveSketch()"><img width=50 height=50  src="img/save.png"></div>
                <div class="topButton" id="config" title="Einstellungen" onclick="Abbozza.showConfiguration()"><img width=50 height=50  src="img/settings.png"></div>		
                <div class="topButton" id="info" title="Informationen"><div class="toolButton" id="serial" onclick="Abbozza.openTaskWindow()"><img width=50 height=50  src="img/info.png"></div></div>
                <div class="license_div">
                    Based on <a href="https://developers.google.com/blockly/">Blockly</a>, 
                    Icons and images designed by <a href="http://www.flaticon.com/authors/freepik">Freepik</a>
                </div>
            </div>
        </div> 

    <xml id="startBlocks" style="display: none">
        <block type="main" id="main" inline="false" x="100" y="100"></block>
        <block type="devices" id="block_global_vars" inline="false" x="500" y="20"></block>
    </xml>
    <xml id="startBlocksWoDevices" style="display: none">
        <block type="main" id="main" inline="false" x="100" y="20"></block>
    </xml>    
</body>
</html>
